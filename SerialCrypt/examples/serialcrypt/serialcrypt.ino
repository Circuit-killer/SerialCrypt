#include <SoftwareSerial.h>
#include <SerialCrypt.h>

SoftwareSerial debug(7,8);
SerialCrypt scrypt;

uint8_t rc4key[] = "\xdb\xae\x36\xe9\x87\xfc\x2b\xd3\xcf\xd3\xfa\x2c\xac\x46\x27\x55\xdb\xae\x36\xe9\x87\xfc\x2b\xd3\xcf\xd3\xfa\x2c\xac\x46\x27\x55";
uint8_t hmac_key[] = "\x22\xfe\xfd\x0c\xee\xe7\x43\xd6\x0f\x65\xfa\x0e\x24\x73\x73\xc3\x67\xbc\x74\x53\x30\xa8\x42\x1e\x94\x62\x08\xde\x28\xf9\x87\x94\xd0\x62\x7c\x17\x93\x30\x0b\xe5\xc1\x3a\xb7\x1e\x67\x6a\xc0\xa7\x67\x37\xbc\x7c\x80\x59\x0b\x0c\x8e\xc7\x36\x50\x75\xf4\x38\x96\xaa\x0a\xfe\x0c\x27\x16\xa2\x18\x33\xa6\x82\x38\xfa\x34\x4f\x47\x4f\x38\xa7\xf9\xf0\xba\x82\x9e\x88\x6c\x97\x41\x70\x24\x5a\xbd\x0f\xe0\xe3\xb5\x86\xba\x90\xef\x69\x6c\xbc\xdd\xc9\x49\x46\x3e\x67\xec\x37\x43\x4c\x2b\x1f\xb8\xde\xbd\xee\x11\x18\xdd\x3e\x51\x34\xf3\x7e\x48\xd9\x16\x0a\x79\x55\x8a\x43\xb7\xf8\x54\x3d\xe5\xe7\x62\x6b\x0f\xad\xb0\xd9\x89\x2e\x71\x84\x81\xab\x6d\xd4\x1f\x1a\x67\xdf\xb1\x07\x43\x99\xd2\x49\xe8\x1c\xd2\xf2\x85\xb4\x4f\xde\x8b\x87\x3d\x13\xae\xf8\x3a\xad\x8c\xdc\x53\x02\x2f\x4d\xca\xe3\xc7\x4d\x1b\x49\x98\xe1\x2f\x59\x74\x90\xcb\x1b\xb1\xf7\xb3\x53\x1b\x8b\x2f\x46\x2a\x4c\x82\x0c\x77\xbb\x22\x4d\x51\x07\xbd\x91\x19\x18\x53\xae\x84\x37\x10\xcd\xef\xb0\x93\xee\xe8\x1d\x8b\x40\x15\x8e\xf1\x6d\xa0\x83\x57\xa3\x8a\x7e\x7e\x29\x69\x64\xd6";
uint32_t len;

void setup()
{
  Serial.begin(9600);
  debug.begin(9600);
  while ( !Serial )
    delay(10);
  
  scrypt.SetSerial ( &Serial );
  scrypt.SetSerialDebug ( &debug );
  scrypt.SetRC4Key ( rc4key , sizeof ( rc4key ) );
  scrypt.SetHMACKey ( hmac_key , sizeof ( hmac_key ) );
  scrypt.begin ( BigNumber ( "104683" ) );
}

void loop()
{
  len = scrypt.recvCrypt();
  scrypt.sendCrypt(len);
  delay(100);
}
